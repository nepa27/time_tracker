{% extends 'base.html' %}
{% block title %}Изменение данных{% endblock %}
{% block content %}

<div id="error-message" style="color: red; display: none;"></div>

{% for item in data %}
<form id="edit-form-{{ item.id }}" class="edit-form">
  <div class="task-item">
      <strong>Дата: <input class="form-control" type="date" id="date" name="date" value="{{ item.date }}" required></strong>
      <p>Название дела:<input class="form-control" type="text" id="name_of_work" name="name_of_work" value="{{ item.name_of_work }}" required></p>
      <p>Время: <input class="form-control" type="text" id="time" name="time" value="{{ item.time }}" required></p>
      <button type="submit" class="table-button">Обновить задачу</button>
  </div>
</form>
{% endfor %}

<script>
document.addEventListener('DOMContentLoaded', function() {
    const editForms = document.querySelectorAll('.edit-form');

    editForms.forEach(form => {
        form.addEventListener('submit', function(event) {
            event.preventDefault();

            const work_id = form.id.split('-')[2];
            const formData = new FormData(form);

            fetch('{{ url_for("timer.edit", work_id=0) }}'.replace('0', work_id), {
                method: 'POST',
                body: formData
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                return response.json();
            })
            .then(data => {
                window.location.href = '/';
            })
            .catch(error => {
                const errorMessage = error.message || 'Произошла ошибка';
                document.getElementById('error-message').textContent = errorMessage;
                document.getElementById('error-message').style.display = 'block';
            });
        });
    });
});
</script>

{% endblock %}